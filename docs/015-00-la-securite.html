<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-02-27T21:47:43.900077"><title>La s&eacute;curit&eacute; | nestjs</title><script type="application/json" id="virtual-toc-data">[{"id":"clef-d-api","level":0,"title":"Clef d\u0027API","anchor":"#clef-d-api"},{"id":"authentification-par-token","level":0,"title":"Authentification par token","anchor":"#authentification-par-token"},{"id":"autorisation","level":0,"title":"Autorisation","anchor":"#autorisation"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="La s&eacute;curit&eacute; | nestjs"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="nestjs Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/015-00-la-securite.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="La s&eacute;curit&eacute; | nestjs"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/015-00-la-securite.html#webpage",
    "url": "writerside-documentation/015-00-la-securite.html",
    "name": "La s&eacute;curit&eacute; | nestjs",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "nestjs Help"
}</script><!-- End Schema.org --></head><body data-id="015-00-La-securite" data-main-title="La sécurité" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>nestjs  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="015-00-La-securite" id="015-00-La-securite.md">La sécurité</h1><section class="chapter"><h2 id="clef-d-api" data-toc="clef-d-api">Clef d'API</h2><p id="-4ojokv_6">Une des fa&ccedil;ons les plus simples de s&eacute;curiser l'acc&egrave;s &agrave; une API reste d'utiliser une cl&eacute; qui sera transmise et test&eacute;e avec chaque requ&ecirc;te.</p><section class="chapter"><h3 id="les-guards" data-toc="les-guards">Les Guards</h3><p id="-4ojokv_10">Pour d&eacute;clencher automatiquement le test de l'autorisation, nous utiliserons le syst&egrave;me de <code class="code" id="-4ojokv_20">Guard</code> propos&eacute; par NestJS.</p><ul class="list _bullet" id="-4ojokv_11"><li class="list__item" id="-4ojokv_21"><p id="-4ojokv_25">Un <code class="code" id="-4ojokv_26">Guard</code> est un m&eacute;canisme de protection permettant d&rsquo;autoriser ou de refuser l&rsquo;acc&egrave;s &agrave; une route en fonction de certaines conditions.</p></li><li class="list__item" id="-4ojokv_22"><p id="-4ojokv_27">Un <code class="code" id="-4ojokv_28">Guard</code> est ex&eacute;cut&eacute; avant qu'un contr&ocirc;leur ou un gestionnaire de requ&ecirc;tes soit appel&eacute;. Il sert principalement &agrave; g&eacute;rer l'authentification et l&rsquo;autorisation.</p></li><li class="list__item" id="-4ojokv_23"><p id="-4ojokv_29">Un <code class="code" id="-4ojokv_30">Guard</code> impl&eacute;mente l'interface <code class="code" id="-4ojokv_31">CanActivate</code> et doit retourner un bool&eacute;en.</p></li><li class="list__item" id="-4ojokv_24"><p id="-4ojokv_32">Un <code class="code" id="-4ojokv_33">Guard</code> acc&egrave;de au contexte d'&eacute;x&eacute;cution de la requ&ecirc;te.</p></li></ul><p id="-4ojokv_12">Nous pouvons demander &agrave; NestJS la g&eacute;n&eacute;ration d'une classe guard comme ceci :</p><div class="code-block" data-lang="bash">
nest generate guard api-key
</div><p id="-4ojokv_14">Modifions ensuite le code de la classe g&eacute;n&eacute;r&eacute;e pour :</p><ul class="list _bullet" id="-4ojokv_15"><li class="list__item" id="-4ojokv_34"><p>Renommer le dossier <code class="code" id="-4ojokv_37">api-key</code> en <code class="code" id="-4ojokv_38">guards</code>.</p></li><li class="list__item" id="-4ojokv_35"><p>Injecter <code class="code" id="-4ojokv_39">ConfigService</code> afin de r&eacute;cup&eacute;rer la clef d'API.</p></li><li class="list__item" id="-4ojokv_36"><p>Comparer la clef transmise avec celle de l'environnement et lever une exception si les deux diff&egrave;rent.</p></li></ul><aside class="prompt" data-type="tip" data-title="" id="-4ojokv_16"><p id="-4ojokv_40">pour le dev, il faudra ajouter <code class="code" id="-4ojokv_41">API_KEY</code> dans notre fichier <code class="code" id="-4ojokv_42">.env</code>).</p></aside><div class="code-block" data-lang="ts">
// guards/api-key.guard.ts

import { CanActivate, ExecutionContext, Injectable, UnauthorizedException } from '@nestjs/common';
import { Observable } from 'rxjs';
import { ConfigService } from '@nestjs/config';

@Injectable()
export class ApiKeyGuard implements CanActivate
{

  constructor(
    // Injection de ConfigService
    // pour récupérer la clef d'API
    // dans les variables d'environnement
    private readonly configService: ConfigService
  ) {}

  canActivate(
    context: ExecutionContext,
  ): boolean | Promise&lt;boolean&gt; | Observable&lt;boolean&gt;
  {
    // Conversion du contexte d'exécution en contexte http
    // pour pouvoir lire les en-têtes
    const request = context.switchToHttp().getRequest();

    // Lecture de l'en-tête http
    const apiKey = request.headers['x-api-key'];

    // comparaison de la clef d'API transmise
    // avec la requête avec celle de l'environnement
    if (
          !apiKey 
          || apiKey !== this.configService.get&lt;string&gt;('API_KEY')
        ) 
    {
      throw new UnauthorizedException(
        'Clef API invalide'
      );
    }

    // Si Aucune exception, autorisation de l'accès
    return true;
  }
}
</div><p id="-4ojokv_18">Le fichier <code class="code" id="-4ojokv_43">.env</code>, attention, il faut relancer le serveur apr&egrave;s toute modification de l'environnement.</p><div class="code-block" data-lang="none">
// .env

PORT=3000
MONGO_URI=mongodb://localhost:27025/formation
API_KEY=123
</div></section><section class="chapter"><h3 id="utilisation-d-un-guard" data-toc="utilisation-d-un-guard">Utilisation d'un <code class="code" id="-4ojokv_46">Guard</code></h3><section class="chapter"><h4 id="dans-un-contr-leur" data-toc="dans-un-contr-leur">Dans un contr&ocirc;leur</h4><p id="-4ojokv_47">Pour ne prot&eacute;ger que quelques routes de notre application, nous pouvons agir directement dans les m&eacute;thodes du contr&ocirc;leur.</p><div class="code-block" data-lang="ts">
import { Controller, Get, UseGuards } from '@nestjs/common';
import { ApiKeyGuard } from './guards/api-key.guard';

@Controller('protected')
export class ProtectedController {
  @Get()
  @UseGuards(ApiKeyGuard)
  securedRoute() {
    return { message: 'Route protégée' };
  }
}
</div><p id="-4ojokv_49">Nous pouvons &eacute;galement prot&eacute;ger toutes les routes d'un contr&ocirc;leur. Pour cela, il suffit de d&eacute;corer la classe avec <code class="code" id="-4ojokv_51">@UseGuard</code>.</p><div class="code-block" data-lang="ts">
@UseGuards(ApiKeyGuard)
@Controller('protected')
export class ProtectedController {
  @Get()
  getProtectedData() {
    return { message: 'Route protégée' };
  }
}
</div></section></section><section class="chapter"><h3 id="exercice" data-toc="exercice">Exercice</h3><p id="-4ojokv_52">S&eacute;curiser les routes de <code class="code" id="-4ojokv_54">BookController</code> avec une clef d'API.</p><p id="-4ojokv_53"><span class="control" id="-4ojokv_55">Variante :</span> Une collection users pourrait stoker des clefs d'API diff&eacute;rentes selon les utilisateurs.</p></section></section><section class="chapter"><h2 id="authentification-par-token" data-toc="authentification-par-token">Authentification par token</h2><p id="-4ojokv_56">L'authentification par token est une m&eacute;thode d'authentification o&ugrave; un utilisateur re&ccedil;oit un jeton (token) apr&egrave;s s&rsquo;&ecirc;tre authentifi&eacute; une premi&egrave;re fois avec ses identifiants. Ce token est ensuite utilis&eacute; pour prouver son identit&eacute; lors des requ&ecirc;tes suivantes, sans avoir &agrave; ressaisir ses identifiants &agrave; chaque fois.</p><section class="chapter"><h3 id="principe-de-fonctionnement" data-toc="principe-de-fonctionnement">Principe de fonctionnement</h3><ol class="list _decimal" id="-4ojokv_60" type="1"><li class="list__item" id="-4ojokv_63"><p id="-4ojokv_66"><span class="control" id="-4ojokv_68">Connexion initiale</span></p><ul class="list _bullet" id="-4ojokv_67"><li class="list__item" id="-4ojokv_69"><p>L'utilisateur envoie ses identifiants (email/mot de passe, cl&eacute; API, etc.) au serveur.</p></li><li class="list__item" id="-4ojokv_70"><p>Le serveur v&eacute;rifie ces informations.</p></li><li class="list__item" id="-4ojokv_71"><p>Si elles sont valides, il g&eacute;n&egrave;re un token (souvent sous la forme d&rsquo;une cha&icirc;ne encod&eacute;e en JWT ou un UUID).</p></li><li class="list__item" id="-4ojokv_72"><p>Ce token est renvoy&eacute; &agrave; l'utilisateur.</p></li></ul></li><li class="list__item" id="-4ojokv_64"><p id="-4ojokv_73"><span class="control" id="-4ojokv_75">Utilisation du token</span></p><ul class="list _bullet" id="-4ojokv_74"><li class="list__item" id="-4ojokv_76"><p id="-4ojokv_78">Lors des requ&ecirc;tes suivantes, l'utilisateur envoie le token</p><ul class="list _bullet" id="-4ojokv_79"><li class="list__item" id="-4ojokv_80"><p>souvent dans l&rsquo;en-t&ecirc;te HTTP <code class="code" id="-4ojokv_81">Authorization: Bearer &lt;token&gt;</code>.</p></li></ul></li><li class="list__item" id="-4ojokv_77"><p id="-4ojokv_82">Le serveur v&eacute;rifie la validit&eacute; du token avant d&rsquo;accorder l'acc&egrave;s aux ressources demand&eacute;es.</p></li></ul></li><li class="list__item" id="-4ojokv_65"><p id="-4ojokv_83"><span class="control" id="-4ojokv_84">Expiration et renouvellement</span></p></li></ol><ul class="list _bullet" id="-4ojokv_61"><li class="list__item" id="-4ojokv_85"><p>Les tokens peuvent expirer apr&egrave;s un certain temps pour des raisons de s&eacute;curit&eacute;.</p></li><li class="list__item" id="-4ojokv_86"><p>Certains syst&egrave;mes impl&eacute;mentent un refresh token, qui permet d&rsquo;obtenir un nouveau token sans se reconnecter.</p></li></ul><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="378px" preserveAspectRatio="none" style="width:583px;height:378px;background:#FFFFFF;" version="1.1" viewBox="0 0 583 378" width="583px" zoomAndPan="magnify"><defs/><g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="32" x2="32" y1="36.4883" y2="342.9727"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="362" x2="362" y1="36.4883" y2="342.9727"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="12" y="25.5352">Client</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54" x="5" y="341.9727"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="12" y="362.5078">Client</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="321" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="328" y="25.5352">NestJSAPP</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="321" y="341.9727"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="328" y="362.5078">NestJSAPP</text><polygon fill="#181818" points="350,63.7988,360,67.7988,350,71.7988,354,67.7988" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="32" x2="356" y1="67.7988" y2="67.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="244" x="39" y="63.0566">POST auth/login {username, password}</text><line style="stroke:#181818;stroke-width:1.0;" x1="362" x2="404" y1="97.1094" y2="97.1094"/><line style="stroke:#181818;stroke-width:1.0;" x1="404" x2="404" y1="97.1094" y2="110.1094"/><line style="stroke:#181818;stroke-width:1.0;" x1="363" x2="404" y1="110.1094" y2="110.1094"/><polygon fill="#181818" points="373,106.1094,363,110.1094,373,114.1094,369,110.1094" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="369" y="92.3672">Validation/authentification</text><line style="stroke:#181818;stroke-width:1.0;" x1="362" x2="404" y1="139.4199" y2="139.4199"/><line style="stroke:#181818;stroke-width:1.0;" x1="404" x2="404" y1="139.4199" y2="152.4199"/><line style="stroke:#181818;stroke-width:1.0;" x1="363" x2="404" y1="152.4199" y2="152.4199"/><polygon fill="#181818" points="373,148.4199,363,152.4199,373,156.4199,369,152.4199" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="113" x="369" y="134.6777">Cr&#233;ation du token</text><polygon fill="#181818" points="43,177.7305,33,181.7305,43,185.7305,39,181.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="37" x2="361" y1="181.7305" y2="181.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="49" y="176.9883">{token, username, userId}</text><polygon fill="#181818" points="350,207.041,360,211.041,350,215.041,354,211.041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="32" x2="356" y1="211.041" y2="211.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="306" x="39" y="206.2988">GET /any-route Authorization="Bearer &lt;token&gt;"</text><line style="stroke:#181818;stroke-width:1.0;" x1="362" x2="404" y1="240.3516" y2="240.3516"/><line style="stroke:#181818;stroke-width:1.0;" x1="404" x2="404" y1="240.3516" y2="253.3516"/><line style="stroke:#181818;stroke-width:1.0;" x1="363" x2="404" y1="253.3516" y2="253.3516"/><polygon fill="#181818" points="373,249.3516,363,253.3516,373,257.3516,369,253.3516" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="369" y="235.6094">Validation du token</text><line style="stroke:#181818;stroke-width:1.0;" x1="362" x2="404" y1="282.6621" y2="282.6621"/><line style="stroke:#181818;stroke-width:1.0;" x1="404" x2="404" y1="282.6621" y2="295.6621"/><line style="stroke:#181818;stroke-width:1.0;" x1="363" x2="404" y1="295.6621" y2="295.6621"/><polygon fill="#181818" points="373,291.6621,363,295.6621,373,299.6621,369,295.6621" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="369" y="277.9199">Extraction des donn&#233;es du token</text><polygon fill="#181818" points="43,320.9727,33,324.9727,43,328.9727,39,324.9727" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="37" x2="361" y1="324.9727" y2="324.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="116" x="49" y="320.2305">{username, userId}</text><!--SRC=[ZO_DQi9G48NtUOh1jI5xKS6AbBhGWDBza8nrQ9mRvaxm3n_8v_35cbofgRHYTyEPRywSKw8QProY68mB9h6e_27DoDjqCKhJABfk8HwsOW_I-M89MDawATm72nmhJogueIwKwFtMQNwARlpTCVJW7GlEqTX9qdZKzhpYB0YFZyPwEGS4yWhCVP9yH-l7yHrv3Dikj9cQwQrEz6UNryaI4fHzhAuoWb6To2aVmgz1vuLGIQ4VF8UT_vHg0pw49pjJpAumUSYToENS3C-g_Uxq1G00]--></g></svg></div></section><section class="chapter"><h3 id="jwt-json-web-token" data-toc="jwt-json-web-token">JWT (Json Web Token)</h3><p id="-4ojokv_87">JWT (JSON Web Token) est un format standard pour repr&eacute;senter des informations sous forme d'un token s&eacute;curis&eacute;, utilis&eacute; principalement pour l'authentification et l'autorisation des utilisateurs.</p><p id="-4ojokv_88">Un JWT est une cha&icirc;ne de caract&egrave;res encod&eacute;e qui contient des informations permettant de v&eacute;rifier l'identit&eacute; d'un utilisateur. Il est couramment utilis&eacute; pour s&eacute;curiser les API REST.</p><p id="-4ojokv_89">Un token JWT est compos&eacute; de trois parties s&eacute;par&eacute;es par des points.</p><ul class="list _bullet" id="-4ojokv_90"><li class="list__item" id="-4ojokv_92"><p>Un en-t&ecirc;te qui contient des informations sur le type de token et l'algorithme de signature.</p></li><li class="list__item" id="-4ojokv_93"><p>Un payload (charge utile), qui contient les donn&eacute;es du token</p></li><li class="list__item" id="-4ojokv_94"><p>Une signature qui permet de v&eacute;rifier que le token n'a pas &eacute;t&eacute; modifi&eacute; depuis sa cr&eacute;ation.</p></li></ul><div class="code-block" data-lang="none">
---------------------------------------
| JWT Token Structure                 |
---------------------------------------
| HEADER (Encodé en Base64)           |
| {                                   |
|   &quot;alg&quot;: &quot;HS256&quot;,                   |
|   &quot;typ&quot;: &quot;JWT&quot;                      |
| }                                   |
---------------------------------------
| PAYLOAD (Encodé en Base64)          |
| {                                   |
|   &quot;userId&quot;: &quot;12345&quot;,                |
|   &quot;name&quot;: &quot;John Doe&quot;,               |
|   &quot;exp&quot;: 1710000000                 |
| }                                   |
---------------------------------------
| SIGNATURE                           |
| HMACSHA256(                         |
|   base64UrlEncode(header) + &quot;.&quot; +   |
|   base64UrlEncode(payload),         |
|   SECRET_KEY                        |
| )                                   |
---------------------------------------
</div></section><section class="chapter"><h3 id="passport" data-toc="passport">Passport</h3><p id="-4ojokv_95">Passport est une librairie d'authentification pour NodeJS extr&ecirc;mement populaire. C'est parti particularit&eacute; et qu'elle supporte plus de 500 strat&eacute;gies d'authentification diff&eacute;rentes. La bonne nouvelle est que NestJS peut parfaitement fonctionner avec cette Biblioth&egrave;que.</p><section class="chapter"><h4 id="les-classes-et-les-d-pendances" data-toc="les-classes-et-les-d-pendances">Les classes et les d&eacute;pendances</h4><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="484px" preserveAspectRatio="none" style="width:1245px;height:484px;background:#FFFFFF;" version="1.1" viewBox="0 0 1245 484" width="1245px" zoomAndPan="magnify"><defs/><g><!--class AuthModule--><g id="elem_AuthModule"><rect codeLine="4" fill="#F1F1F1" height="48" id="AuthModule" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="116" x="480" y="7"/><ellipse cx="495" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M497.9731,28.6431 Q497.3921,28.9419 496.7529,29.0913 Q496.1138,29.2407 495.4082,29.2407 Q492.9014,29.2407 491.5815,27.5889 Q490.2617,25.937 490.2617,22.8159 Q490.2617,19.6865 491.5815,18.0347 Q492.9014,16.3828 495.4082,16.3828 Q496.1138,16.3828 496.7612,16.5322 Q497.4087,16.6816 497.9731,16.9805 L497.9731,19.7031 Q497.3423,19.1221 496.7488,18.8523 Q496.1553,18.5825 495.5244,18.5825 Q494.1797,18.5825 493.4949,19.6492 Q492.8101,20.7158 492.8101,22.8159 Q492.8101,24.9077 493.4949,25.9744 Q494.1797,27.041 495.5244,27.041 Q496.1553,27.041 496.7488,26.7712 Q497.3423,26.5015 497.9731,25.9204 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="509" y="28.291">AuthModule</text><line style="stroke:#181818;stroke-width:0.5;" x1="481" x2="595" y1="39" y2="39"/><line style="stroke:#181818;stroke-width:0.5;" x1="481" x2="595" y1="47" y2="47"/></g><!--class AuthService--><g id="elem_AuthService"><rect codeLine="8" fill="#F1F1F1" height="97.4648" id="AuthService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="467" x="304.5" y="115"/><ellipse cx="493.25" cy="131" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M496.2231,136.6431 Q495.6421,136.9419 495.0029,137.0913 Q494.3638,137.2407 493.6582,137.2407 Q491.1514,137.2407 489.8315,135.5889 Q488.5117,133.937 488.5117,130.8159 Q488.5117,127.6865 489.8315,126.0347 Q491.1514,124.3828 493.6582,124.3828 Q494.3638,124.3828 495.0112,124.5322 Q495.6587,124.6816 496.2231,124.9805 L496.2231,127.7031 Q495.5923,127.1221 494.9988,126.8523 Q494.4053,126.5825 493.7744,126.5825 Q492.4297,126.5825 491.7449,127.6492 Q491.0601,128.7158 491.0601,130.8159 Q491.0601,132.9077 491.7449,133.9744 Q492.4297,135.041 493.7744,135.041 Q494.4053,135.041 494.9988,134.7712 Q495.5923,134.5015 496.2231,133.9204 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="513.75" y="136.291">AuthService</text><line style="stroke:#181818;stroke-width:0.5;" x1="305.5" x2="770.5" y1="147" y2="147"/><line style="stroke:#181818;stroke-width:0.5;" x1="305.5" x2="770.5" y1="155" y2="155"/><ellipse cx="315.5" cy="168.7441" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="441" x="324.5" y="172.5352">validateUser(username: string, password: string): Promise&lt;any&gt;</text><ellipse cx="315.5" cy="185.2324" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="348" x="324.5" y="189.0234">login(user: any): Promise&lt;{ access_token: string }&gt;</text><ellipse cx="315.5" cy="201.7207" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="417" x="324.5" y="205.5117">register(username: string, password: string): Promise&lt;User&gt;</text></g><!--class AuthController--><g id="elem_AuthController"><rect codeLine="14" fill="#F1F1F1" height="97.4648" id="AuthController" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="445" x="326.5" y="272.47"/><ellipse cx="493.25" cy="288.47" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M496.2231,294.1131 Q495.6421,294.4119 495.0029,294.5613 Q494.3638,294.7107 493.6582,294.7107 Q491.1514,294.7107 489.8315,293.0589 Q488.5117,291.407 488.5117,288.2859 Q488.5117,285.1565 489.8315,283.5047 Q491.1514,281.8528 493.6582,281.8528 Q494.3638,281.8528 495.0112,282.0022 Q495.6587,282.1516 496.2231,282.4505 L496.2231,285.1731 Q495.5923,284.5921 494.9988,284.3223 Q494.4053,284.0525 493.7744,284.0525 Q492.4297,284.0525 491.7449,285.1192 Q491.0601,286.1858 491.0601,288.2859 Q491.0601,290.3777 491.7449,291.4444 Q492.4297,292.511 493.7744,292.511 Q494.4053,292.511 494.9988,292.2412 Q495.5923,291.9715 496.2231,291.3904 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="513.75" y="293.761">AuthController</text><line style="stroke:#181818;stroke-width:0.5;" x1="327.5" x2="770.5" y1="304.47" y2="304.47"/><line style="stroke:#181818;stroke-width:0.5;" x1="327.5" x2="770.5" y1="312.47" y2="312.47"/><ellipse cx="337.5" cy="326.2141" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="245" x="346.5" y="330.0052">register(body: any): Promise&lt;User&gt;</text><ellipse cx="337.5" cy="342.7024" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="352" x="346.5" y="346.4934">login(body: any): Promise&lt;{ access_token: string }&gt;</text><ellipse cx="337.5" cy="359.1907" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="419" x="346.5" y="362.9817">getProtectedResource(req: any): { message: string, user: any }</text></g><!--class JwtStrategy--><g id="elem_JwtStrategy"><rect codeLine="20" fill="#F1F1F1" height="64.4883" id="JwtStrategy" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="284" x="7" y="288.95"/><ellipse cx="106.75" cy="304.95" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M109.7231,310.5931 Q109.1421,310.8919 108.5029,311.0413 Q107.8638,311.1907 107.1582,311.1907 Q104.6514,311.1907 103.3315,309.5389 Q102.0117,307.887 102.0117,304.7659 Q102.0117,301.6365 103.3315,299.9847 Q104.6514,298.3328 107.1582,298.3328 Q107.8638,298.3328 108.5112,298.4822 Q109.1587,298.6316 109.7231,298.9305 L109.7231,301.6531 Q109.0923,301.0721 108.4988,300.8023 Q107.9053,300.5325 107.2744,300.5325 Q105.9297,300.5325 105.2449,301.5992 Q104.5601,302.6658 104.5601,304.7659 Q104.5601,306.8577 105.2449,307.9244 Q105.9297,308.991 107.2744,308.991 Q107.9053,308.991 108.4988,308.7212 Q109.0923,308.4515 109.7231,307.8704 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="127.25" y="310.241">JwtStrategy</text><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="290" y1="320.95" y2="320.95"/><line style="stroke:#181818;stroke-width:0.5;" x1="8" x2="290" y1="328.95" y2="328.95"/><ellipse cx="18" cy="342.6941" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="258" x="27" y="346.4852">validate(payload: any): Promise&lt;any&gt;</text></g><!--class JwtAuthGuard--><g id="elem_JwtAuthGuard"><rect codeLine="24" fill="#F1F1F1" height="48" id="JwtAuthGuard" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="127" x="285.5" y="429.93"/><ellipse cx="300.5" cy="445.93" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M303.4731,451.5731 Q302.8921,451.8719 302.2529,452.0213 Q301.6138,452.1707 300.9082,452.1707 Q298.4014,452.1707 297.0815,450.5189 Q295.7617,448.867 295.7617,445.7459 Q295.7617,442.6165 297.0815,440.9647 Q298.4014,439.3128 300.9082,439.3128 Q301.6138,439.3128 302.2612,439.4622 Q302.9087,439.6116 303.4731,439.9105 L303.4731,442.6331 Q302.8423,442.0521 302.2488,441.7823 Q301.6553,441.5125 301.0244,441.5125 Q299.6797,441.5125 298.9949,442.5792 Q298.3101,443.6458 298.3101,445.7459 Q298.3101,447.8377 298.9949,448.9044 Q299.6797,449.971 301.0244,449.971 Q301.6553,449.971 302.2488,449.7012 Q302.8423,449.4315 303.4731,448.8504 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="314.5" y="451.221">JwtAuthGuard</text><line style="stroke:#181818;stroke-width:0.5;" x1="286.5" x2="411.5" y1="461.93" y2="461.93"/><line style="stroke:#181818;stroke-width:0.5;" x1="286.5" x2="411.5" y1="469.93" y2="469.93"/></g><!--class UserModule--><g id="elem_UserModule"><rect codeLine="28" fill="#F1F1F1" height="48" id="UserModule" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="114" x="965" y="7"/><ellipse cx="980" cy="23" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M982.9731,28.6431 Q982.3921,28.9419 981.7529,29.0913 Q981.1138,29.2407 980.4082,29.2407 Q977.9014,29.2407 976.5815,27.5889 Q975.2617,25.937 975.2617,22.8159 Q975.2617,19.6865 976.5815,18.0347 Q977.9014,16.3828 980.4082,16.3828 Q981.1138,16.3828 981.7612,16.5322 Q982.4087,16.6816 982.9731,16.9805 L982.9731,19.7031 Q982.3423,19.1221 981.7488,18.8523 Q981.1553,18.5825 980.5244,18.5825 Q979.1797,18.5825 978.4949,19.6492 Q977.8101,20.7158 977.8101,22.8159 Q977.8101,24.9077 978.4949,25.9744 Q979.1797,27.041 980.5244,27.041 Q981.1553,27.041 981.7488,26.7712 Q982.3423,26.5015 982.9731,25.9204 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="994" y="28.291">UserModule</text><line style="stroke:#181818;stroke-width:0.5;" x1="966" x2="1078" y1="39" y2="39"/><line style="stroke:#181818;stroke-width:0.5;" x1="966" x2="1078" y1="47" y2="47"/></g><!--class UserService--><g id="elem_UserService"><rect codeLine="30" fill="#F1F1F1" height="97.4648" id="UserService" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="432" x="806" y="115"/><ellipse cx="978.25" cy="131" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M981.2231,136.6431 Q980.6421,136.9419 980.0029,137.0913 Q979.3638,137.2407 978.6582,137.2407 Q976.1514,137.2407 974.8315,135.5889 Q973.5117,133.937 973.5117,130.8159 Q973.5117,127.6865 974.8315,126.0347 Q976.1514,124.3828 978.6582,124.3828 Q979.3638,124.3828 980.0112,124.5322 Q980.6587,124.6816 981.2231,124.9805 L981.2231,127.7031 Q980.5923,127.1221 979.9988,126.8523 Q979.4053,126.5825 978.7744,126.5825 Q977.4297,126.5825 976.7449,127.6492 Q976.0601,128.7158 976.0601,130.8159 Q976.0601,132.9077 976.7449,133.9744 Q977.4297,135.041 978.7744,135.041 Q979.4053,135.041 979.9988,134.7712 Q980.5923,134.5015 981.2231,133.9204 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="998.75" y="136.291">UserService</text><line style="stroke:#181818;stroke-width:0.5;" x1="807" x2="1237" y1="147" y2="147"/><line style="stroke:#181818;stroke-width:0.5;" x1="807" x2="1237" y1="155" y2="155"/><ellipse cx="817" cy="168.7441" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="336" x="826" y="172.5352">findOne(username: string): Promise&lt;User | null&gt;</text><ellipse cx="817" cy="185.2324" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="406" x="826" y="189.0234">create(username: string, password: string): Promise&lt;User&gt;</text><ellipse cx="817" cy="201.7207" fill="#84BE84" rx="3" ry="3" style="stroke:#038048;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="406" x="826" y="205.5117">validateUser(username: string, pass: string): Promise&lt;any&gt;</text></g><!--class User--><g id="elem_User"><rect codeLine="36" fill="#F1F1F1" height="97.4648" id="User" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="142" x="951" y="272.47"/><ellipse cx="1002.25" cy="288.47" fill="#ADD1B2" rx="11" ry="11" style="stroke:#181818;stroke-width:1.0;"/><path d="M1005.2231,294.1131 Q1004.6421,294.4119 1004.0029,294.5613 Q1003.3638,294.7107 1002.6582,294.7107 Q1000.1514,294.7107 998.8315,293.0589 Q997.5117,291.407 997.5117,288.2859 Q997.5117,285.1565 998.8315,283.5047 Q1000.1514,281.8528 1002.6582,281.8528 Q1003.3638,281.8528 1004.0112,282.0022 Q1004.6587,282.1516 1005.2231,282.4505 L1005.2231,285.1731 Q1004.5923,284.5921 1003.9988,284.3223 Q1003.4053,284.0525 1002.7744,284.0525 Q1001.4297,284.0525 1000.7449,285.1192 Q1000.0601,286.1858 1000.0601,288.2859 Q1000.0601,290.3777 1000.7449,291.4444 Q1001.4297,292.511 1002.7744,292.511 Q1003.4053,292.511 1003.9988,292.2412 Q1004.5923,291.9715 1005.2231,291.3904 Z " fill="#000000"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="1022.75" y="293.761">User</text><line style="stroke:#181818;stroke-width:0.5;" x1="952" x2="1092" y1="304.47" y2="304.47"/><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="959" y="315.2141"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="971" y="322.0052">username: string</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="959" y="331.7024"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="114" x="971" y="338.4934">password: string</text><rect fill="none" height="6" style="stroke:#C82930;stroke-width:1.0;" width="6" x="959" y="348.1907"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="105" x="971" y="354.9817">createdAt: Date</text><line style="stroke:#181818;stroke-width:0.5;" x1="952" x2="1092" y1="361.9348" y2="361.9348"/></g><!--link AuthService to JwtStrategy--><g id="link_AuthService_JwtStrategy"><path codeLine="44" d="M417.32,212.96 C355.75,237.57 288.1615,264.5832 233.7915,286.3132 " fill="none" id="AuthService-to-JwtStrategy" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="228.22,288.54,238.0617,288.9142,232.8629,286.6844,235.0927,281.4855,228.22,288.54" style="stroke:#181818;stroke-width:1.0;"/></g><!--reverse link JwtStrategy to JwtAuthGuard--><g id="link_JwtStrategy_JwtAuthGuard"><path codeLine="45" d="M202.4326,357.1223 C238.1626,380.4723 280.95,408.45 313.25,429.56 " fill="none" id="JwtStrategy-backto-JwtAuthGuard" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="197.41,353.84,202.7557,362.1119,201.5955,356.5753,207.1321,355.4151,197.41,353.84" style="stroke:#181818;stroke-width:1.0;"/></g><!--link UserModule to UserService--><g id="link_UserModule_UserService"><path codeLine="46" d="M1022,55.37 C1022,71.82 1022,88.43 1022,108.66 " fill="none" id="UserModule-to-UserService" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1022,114.66,1026,105.66,1022,109.66,1018,105.66,1022,114.66" style="stroke:#181818;stroke-width:1.0;"/></g><!--link AuthModule to AuthService--><g id="link_AuthModule_AuthService"><path codeLine="47" d="M538,55.37 C538,71.82 538,88.43 538,108.66 " fill="none" id="AuthModule-to-AuthService" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="538,114.66,542,105.66,538,109.66,534,105.66,538,114.66" style="stroke:#181818;stroke-width:1.0;"/></g><!--reverse link AuthService to AuthController--><g id="link_AuthService_AuthController"><path codeLine="48" d="M541.8141,218.635 C543.1541,237.545 544.26,253.25 545.6,272.18 " fill="none" id="AuthService-backto-AuthController" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="541.39,212.65,538.0362,221.9102,541.7434,217.6375,546.0162,221.3447,541.39,212.65" style="stroke:#181818;stroke-width:1.0;"/></g><!--link AuthController to JwtAuthGuard--><g id="link_AuthController_JwtAuthGuard"><path codeLine="49" d="M475.38,370.32 C444.53,390.49 415.0925,409.7276 389.9525,426.1576 " fill="none" id="AuthController-to-JwtAuthGuard" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="384.93,429.44,394.6521,427.8647,389.1154,426.7047,390.2755,421.168,384.93,429.44" style="stroke:#181818;stroke-width:1.0;"/></g><!--link AuthService to UserService--><g id="link_AuthService_UserService"><path codeLine="50" d="M771.96,163.73 C783.2,163.73 788.43,163.73 799.66,163.73 " fill="none" id="AuthService-to-UserService" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="805.66,163.73,796.66,159.73,800.66,163.73,796.66,167.73,805.66,163.73" style="stroke:#181818;stroke-width:1.0;"/></g><!--link UserService to User--><g id="link_UserService_User"><path codeLine="51" d="M1022,212.65 C1022,231.56 1022,247.25 1022,266.18 " fill="none" id="UserService-to-User" style="stroke:#181818;stroke-width:1.0;"/><polygon fill="#181818" points="1022,272.18,1026,263.18,1022,267.18,1018,263.18,1022,272.18" style="stroke:#181818;stroke-width:1.0;"/></g><!--SRC=[dLFTIiCm5BxFKvpBYVO5YWo6WY28ul1QOdBiWcaoyxDHQj_TDDlQD1jZsejGSaw-dEydJ59hOU7TwabpBn7QZX2dAtGhDD0I0k5ZGzCIpKQmq1Nt- -zwGwNWrE6RHJFpOL6qnXAiCq9LDx0EHxVQyCFELGalHjV2uYrLpNp4aReIAWAK42f9NmkKCRJstUalL0SWw9B31YjXtLy7w4VUWNHnpSZUQUMCbZ8ASNpLX-PDFkg8c70wrNW1f-11w7R87F9NjDeRXZE3tmUe5ke0GAk4ww3Udb17EhBZyxXrIsU2JLMp9pCODrlJHchAyn6ZFI4D0q2loOEdXiUGf2aPTUi569EKYTeNJoJeKoZ-hF38kqnN-07bfKmKOWRx-V_f-QNfFPVSZcJq4bv53ZTMyld6oeuINxWIxiFFu28XwVChU35FBIKJTmgVLHDJuid41v8y_LXBhY7P8uYuv-hpIKgc4qzlJPCmZ4J8Bm00]--></g></svg></div><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="238px" preserveAspectRatio="none" style="width:833px;height:238px;background:#FFFFFF;" version="1.1" viewBox="0 0 833 238" width="833px" zoomAndPan="magnify"><defs/><g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="32" x2="32" y1="36.4883" y2="203.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="127" x2="127" y1="36.4883" y2="203.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="243" x2="243" y1="36.4883" y2="203.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="350" x2="350" y1="36.4883" y2="203.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="457" x2="457" y1="36.4883" y2="203.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="561" x2="561" y1="36.4883" y2="203.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="672" x2="672" y1="36.4883" y2="203.041"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="782" x2="782" y1="36.4883" y2="203.041"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="12" y="25.5352">Client</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="54" x="5" y="202.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="40" x="12" y="222.5762">Client</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117" x="69" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="76" y="25.5352">AuthController</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117" x="69" y="202.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="76" y="222.5762">AuthController</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95" x="196" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="203" y="25.5352">AuthService</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95" x="196" y="202.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="203" y="222.5762">AuthService</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="301" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="308" y="25.5352">AuthModule</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="301" y="202.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="308" y="222.5762">AuthModule</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="409" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="416" y="25.5352">UserModule</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="409" y="202.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="416" y="222.5762">UserModule</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="93" x="515" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="522" y="25.5352">UserService</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="93" x="515" y="202.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="79" x="522" y="222.5762">UserService</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="618" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="625" y="25.5352">JwtAuthGuard</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="618" y="202.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="625" y="222.5762">JwtAuthGuard</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="737" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="744" y="25.5352">JwtStrategy</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="90" x="737" y="202.041"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="76" x="744" y="222.5762">JwtStrategy</text><polygon fill="#181818" points="115.5,63.7988,125.5,67.7988,115.5,71.7988,119.5,67.7988" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="32" x2="121.5" y1="67.7988" y2="67.7988"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="39" y="63.0566">GET /login</text><polygon fill="#181818" points="231.5,93.1094,241.5,97.1094,231.5,101.1094,235.5,97.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127.5" x2="237.5" y1="97.1094" y2="97.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="134.5" y="92.3672">inject</text><polygon fill="#181818" points="231.5,122.4199,241.5,126.4199,231.5,130.4199,235.5,126.4199" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="127.5" x2="237.5" y1="126.4199" y2="126.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="40" x="134.5" y="121.6777">login()</text><polygon fill="#181818" points="549.5,151.7305,559.5,155.7305,549.5,159.7305,553.5,155.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="243.5" x2="555.5" y1="155.7305" y2="155.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="35" x="250.5" y="150.9883">inject</text><polygon fill="#181818" points="549.5,181.041,559.5,185.041,549.5,189.041,553.5,185.041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="243.5" x2="555.5" y1="185.041" y2="185.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="84" x="250.5" y="180.2988">validateuser()</text><!--SRC=[XOx12i8m44Jl-OeSzI3UUn2aI47mrFe1eLdgIaZ2kgduzwPQ8KaLhs-6D-CLCVRebMLP6mJBmYTe7_XIEylaZ05QH2tGY3qi-CdfO428B3ZVWEQWnDyynpjFgYOeqcNGCYc6uH4NtgVbPbTyhMHpwEJMk06joADFULwj9DehzFolzLAjrYA1KoVvdvb-LKPbKCVt8S9e4qy0]--></g></svg></div><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="986px" preserveAspectRatio="none" style="width:1206px;height:986px;background:#FFFFFF;" version="1.1" viewBox="0 0 1206 986" width="1206px" zoomAndPan="magnify"><defs/><g><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="43" x2="43" y1="81.4883" y2="905.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="408.5" x2="408.5" y1="81.4883" y2="905.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="646.5" x2="646.5" y1="81.4883" y2="905.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="851" x2="851" y1="81.4883" y2="905.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="952" x2="952" y1="81.4883" y2="905.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1039" x2="1039" y1="81.4883" y2="905.5625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1139" x2="1139" y1="81.4883" y2="905.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="5" y="78.5352">Utilisateur</text><ellipse cx="43" cy="13.5" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M43,21.5 L43,48.5 M30,29.5 L56,29.5 M43,48.5 L30,63.5 M43,48.5 L56,63.5 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="5" y="918.0977">Utilisateur</text><ellipse cx="43" cy="929.5508" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M43,937.5508 L43,964.5508 M30,945.5508 L56,945.5508 M43,964.5508 L30,979.5508 M43,964.5508 L56,979.5508 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117" x="350.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="357.5" y="70.5352">AuthController</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="117" x="350.5" y="904.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="103" x="357.5" y="925.0977">AuthController</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95" x="599.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="606.5" y="70.5352">AuthService</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="95" x="599.5" y="904.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="81" x="606.5" y="925.0977">AuthService</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="801" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="808" y="70.5352">UsersService</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="100" x="801" y="904.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="808" y="925.0977">UsersService</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="911" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="918" y="70.5352">JwtService</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="911" y="904.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="918" y="925.0977">JwtService</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1003" y="78.5352">MongoDB</text><path d="M1021,29 C1021,19 1039,19 1039,19 C1039,19 1057,19 1057,29 L1057,55 C1057,65 1039,65 1039,65 C1039,65 1021,65 1021,55 L1021,29 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1021,29 C1021,39 1039,39 1039,39 C1039,39 1057,39 1057,29 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="66" x="1003" y="918.0977">MongoDB</text><path d="M1021,931.0508 C1021,921.0508 1039,921.0508 1039,921.0508 C1039,921.0508 1057,921.0508 1057,931.0508 L1057,957.0508 C1057,967.0508 1039,967.0508 1039,967.0508 C1039,967.0508 1021,967.0508 1021,957.0508 L1021,931.0508 " fill="#E2E2F0" style="stroke:#181818;stroke-width:1.5;"/><path d="M1021,931.0508 C1021,941.0508 1039,941.0508 1039,941.0508 C1039,941.0508 1057,941.0508 1057,931.0508 " fill="none" style="stroke:#181818;stroke-width:1.5;"/><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1085" y="50"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="1092" y="70.5352">JwtAuthGuard</text><rect fill="#E2E2F0" height="30.4883" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="109" x="1085" y="904.5625"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="95" x="1092" y="925.0977">JwtAuthGuard</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1199" x="0" y="112.1436"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1199" y1="112.1436" y2="112.1436"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1199" y1="115.1436" y2="115.1436"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="90" x="554.5" y="101.4883"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="72" x="560.5" y="118.0566">Inscription</text><polygon fill="#181818" points="397,152.1094,407,156.1094,397,160.1094,401,156.1094" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="43" x2="403" y1="156.1094" y2="156.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="267" x="50" y="151.3672">POST /auth/register (username, password)</text><polygon fill="#181818" points="635,181.4199,645,185.4199,635,189.4199,639,185.4199" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="409" x2="641" y1="185.4199" y2="185.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="185" x="416" y="180.6777">register(username, password)</text><polygon fill="#181818" points="839,210.7305,849,214.7305,839,218.7305,843,214.7305" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="647" x2="845" y1="214.7305" y2="214.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="654" y="209.9883">create(username, password)</text><polygon fill="#181818" points="1027,240.041,1037,244.041,1027,248.041,1031,244.041" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="851" x2="1033" y1="244.041" y2="244.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="136" x="858" y="239.2988">Enregistrer utilisateur</text><polygon fill="#181818" points="658,269.3516,648,273.3516,658,277.3516,654,273.3516" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="652" x2="850" y1="273.3516" y2="273.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="664" y="268.6094">Retourne utilisateur cr&#233;&#233;</text><polygon fill="#181818" points="420,298.6621,410,302.6621,420,306.6621,416,302.6621" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="414" x2="646" y1="302.6621" y2="302.6621"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="426" y="297.9199">Retourne utilisateur</text><polygon fill="#181818" points="54,327.9727,44,331.9727,54,335.9727,50,331.9727" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="48" x2="408" y1="331.9727" y2="331.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="131" x="60" y="327.2305">Succ&#232;s (201 Created)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1199" x="0" y="360.6279"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1199" y1="360.6279" y2="360.6279"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1199" y1="363.6279" y2="363.6279"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="90" x="554.5" y="349.9727"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="72" x="560.5" y="366.541">Connexion</text><polygon fill="#181818" points="397,400.5938,407,404.5938,397,408.5938,401,404.5938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="43" x2="403" y1="404.5938" y2="404.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251" x="50" y="399.8516">POST /auth/login (username, password)</text><polygon fill="#181818" points="635,429.9043,645,433.9043,635,437.9043,639,433.9043" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="409" x2="641" y1="433.9043" y2="433.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="214" x="416" y="429.1621">validateUser(username, password)</text><polygon fill="#181818" points="839,459.2148,849,463.2148,839,467.2148,843,463.2148" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="647" x2="845" y1="463.2148" y2="463.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="654" y="458.4727">findOne(username)</text><polygon fill="#181818" points="1027,488.5254,1037,492.5254,1027,496.5254,1031,492.5254" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="851" x2="1033" y1="492.5254" y2="492.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="132" x="858" y="487.7832">Recherche utilisateur</text><polygon fill="#181818" points="862,517.8359,852,521.8359,862,525.8359,858,521.8359" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="856" x2="1038" y1="521.8359" y2="521.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="124" x="868" y="517.0938">Retourne utilisateur</text><polygon fill="#181818" points="658,547.1465,648,551.1465,658,555.1465,654,551.1465" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="652" x2="850" y1="551.1465" y2="551.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="180" x="664" y="546.4043">V&#233;rifie mot de passe (bcrypt)</text><polygon fill="#181818" points="940,576.457,950,580.457,940,584.457,944,580.457" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="647" x2="946" y1="580.457" y2="580.457"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="654" y="575.7148">G&#233;n&#233;rer JWT (sign)</text><polygon fill="#181818" points="658,605.7676,648,609.7676,658,613.7676,654,609.7676" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="652" x2="951" y1="609.7676" y2="609.7676"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="83" x="664" y="605.0254">Retourne JWT</text><polygon fill="#181818" points="420,635.0781,410,639.0781,420,643.0781,416,639.0781" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="414" x2="646" y1="639.0781" y2="639.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="426" y="634.3359">Retourne access_token</text><polygon fill="#181818" points="54,664.3887,44,668.3887,54,672.3887,50,668.3887" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="48" x2="408" y1="668.3887" y2="668.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="128" x="60" y="663.6465">JSON (access_token)</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1199" x="0" y="697.0439"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1199" y1="697.0439" y2="697.0439"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1199" y1="700.0439" y2="700.0439"/><rect fill="#EEEEEE" height="23.3105" style="stroke:#000000;stroke-width:2.0;" width="204" x="497.5" y="686.3887"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="186" x="503.5" y="702.957">Acc&#232;s &#224; une route prot&#233;g&#233;e</text><polygon fill="#181818" points="397,737.0098,407,741.0098,397,745.0098,401,741.0098" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="43" x2="403" y1="741.0098" y2="741.0098"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="342" x="50" y="736.2676">POST /auth/protected (Authorization: Bearer &lt;token&gt;)</text><polygon fill="#181818" points="1127.5,766.3203,1137.5,770.3203,1127.5,774.3203,1131.5,770.3203" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="409" x2="1133.5" y1="770.3203" y2="770.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="85" x="416" y="765.5781">V&#233;rifier token</text><polygon fill="#181818" points="963,795.6309,953,799.6309,963,803.6309,959,799.6309" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="957" x2="1138.5" y1="799.6309" y2="799.6309"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="135" x="969" y="794.8887">V&#233;rifier signature JWT</text><polygon fill="#181818" points="1127.5,824.9414,1137.5,828.9414,1127.5,832.9414,1131.5,828.9414" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="952" x2="1133.5" y1="828.9414" y2="828.9414"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="38" x="959" y="824.1992">Valide</text><polygon fill="#181818" points="420,854.252,410,858.252,420,862.252,416,858.252" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="414" x2="1138.5" y1="858.252" y2="858.252"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="426" y="853.5098">Ajoute req.user</text><polygon fill="#181818" points="54,883.5625,44,887.5625,54,891.5625,50,887.5625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="48" x2="408" y1="887.5625" y2="887.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="60" y="882.8203">{ message: "Acc&#232;s autoris&#233;", user }</text><!--SRC=[ZPJFRfmm4CRlFCM84v7IfEqHTIF1RXKLgTqgXFPOEMP2tB8s7PkaVzHtwR4y1o_MCUngsOHgU-32V9xvvlTXX7I6e72gLbOuR2be13abLIEqWp1ftTtIQ4Uchf5241QIvLD9ZdIl98xr_B1UM2Gx5HIF1Dc3cvQpF2Y54pV28eHlZQxCAXqAgpG85WjuewqarJXbD2mMmSGwFBjWTp6yN-VNS2xOrpbXfQn3WgXb6rfiy1GQOUs3eV8aI9R3aJo6dMvUbdjPmJ99o9DcHSKWMgKnlDPZD-AnxGIiLsp7NQ4pBMcSrhbvt_NTC6sxo9niCEtjx5_5aBTIzdyiH2-Vlu3bO98jULeSdiPl_yMgDfNInq3TYrfnFEXJFGBhLkbohVUqfeokKDuXyNEmsYeTL_i7eId13tr7wbOXR8o34WS32D6DfE-Dsxd8M7ZPTvgrd4NsyHeYgofz4cGpKN1vbhsG4gtzvCmNrBFmitpz3gAfR4IVZ9dqlw7bDcHQnpR9kBwh-WwFv-6rA3b9YFmTCwH-2F_Lnv2Yy0kz6ePTxEBn5yaBBrj1PRX7H31wFwpl-EnL7ermBOqejeYUDFNvuqmlRpxvF2n9-FNCXpvBwoTic9EeCEPVnqY8j-NbRD-5f-3FmQ-_]--></g></svg></div></section><section class="chapter"><h4 id="installation" data-toc="installation">Installation</h4><div class="code-block" data-lang="bash">
npm install @nestjs/passport \
            passport passport-jwt \
            @nestjs/jwt \
            jsonwebtoken
</div></section><section class="chapter"><h4 id="cr-ation-des-modules" data-toc="cr-ation-des-modules">Cr&eacute;ation des modules</h4><div class="code-block" data-lang="bash">
nest generate module auth
</div><div class="code-block" data-lang="bash">
nest generate module user
</div></section><section class="chapter"><h4 id="le-module-user" data-toc="le-module-user">Le module user</h4><div class="code-block" data-lang="ts">
// user/user.schema.ts

import { Prop, Schema, SchemaFactory } from '@nestjs/mongoose';
import { Document } from 'mongoose';

export type UserDocument = User &amp; Document;

@Schema()
export class User {
  @Prop({ required: true, unique: true })
  username: string;

  @Prop({ required: true })
  password: string; // Stocké hashé !

}

export const UserSchema = SchemaFactory.createForClass(User);
</div><div class="code-block" data-lang="ts">
import { Injectable } from '@nestjs/common';
import { InjectModel } from '@nestjs/mongoose';
import { Model } from 'mongoose';
import * as bcrypt from 'bcrypt';
import { User, UserDocument } from './schemas/user.schema';

@Injectable()
export class UsersService {
  constructor(
    @InjectModel(User.name) private userModel: Model&lt;UserDocument&gt;
  ) {}

  async findOne(
    username: string
  ): Promise&lt;User | null&gt; 
  {
    return this.userModel
            .findOne({ username })
            .exec();
  }

  async create(
        username: string
        , password: string
  ): Promise&lt;User&gt; 
  {
    const hashedPassword = await bcrypt
                           .hash(password, 10);
                           
    const newUser = new this.userModel(
        { username, password: hashedPassword }
    );
    
    return newUser.save();
  }

  async validateUser(
    username: string, 
    pass: string
  ): Promise&lt;any&gt; 
  {
    const user = await this.findOne(username);
    
    if (user &amp;&amp; 
        (await bcrypt.compare(pass, user.password))
    ) 
    {
      const { password, ...result } = user.toObject();
      return result;
    }
    return null;
  }
}
</div><div class="code-block" data-lang="ts">
// user/user.module.ts

import { Module } from '@nestjs/common';
import { MongooseModule } from '@nestjs/mongoose';
import { UsersService } from './user.service';
import { User, UserSchema } from './user.schema';

@Module({
  imports: [
    MongooseModule.forFeature([
        { name: User.name, schema: UserSchema }
    ])
  ],
  providers: [UserService],
  exports: [UserService],
})
export class UsersModule {}
</div></section><section class="chapter"><h4 id="le-module-auth" data-toc="le-module-auth">Le module auth</h4><div class="code-block" data-lang="ts">
// auth/auth.service.ts

import { Injectable } from '@nestjs/common';
import { JwtService } from '@nestjs/jwt';
import { UserService } from '../user/user.service';

@Injectable()
export class AuthService {
  constructor(
    private readonly userService: UsersService,
    private readonly jwtService: JwtService
  ) {}

  async validateUser(
    username: string, 
    pass: string
  ): Promise&lt;any&gt; 
  {
    return this.usersService
               .validateUser(username, pass);
  }

  async login(user: any) 
  {
    const payload = { 
        username: user.username, sub: user._id 
    };
    return {
      access_token: this.jwtService.sign(payload),
    };
  }

  async register(
    username: string, password: string) 
  {
    return this.usersService.create(username, password);
  }
}
</div><div class="code-block" data-lang="ts">
// auth/auth.controller.ts

import { Controller, Post, Body, 
         Request, UseGuards 
} from '@nestjs/common';
import { AuthService } from './auth.service';
import { JwtAuthGuard } from './jwt-auth.guard';

@Controller('auth')
export class AuthController {
  constructor(
    private readonly authService: AuthService
  ) {}

  @Post('register')
  async register(@Body() body) {
    return this.authService
               .register(body.username, body.password);
  }

  @Post('login')
  async login(@Body() body) {
    return this.authService.login(body);
  }

  @Post('protected')
  @UseGuards(JwtAuthGuard)
  getProtectedResource(@Request() req) {
    return { 
        message: 'Vous avez accès !', 
        user: req.user 
    };
  }
}

</div><div class="code-block" data-lang="ts">
// auth/auth.module.ts

import { Module } from '@nestjs/common';
import { AuthService } from './auth.service';
import { JwtModule } from '@nestjs/jwt';
import { PassportModule } from '@nestjs/passport';
import { JwtStrategy } from './jwt.strategy';
import { ConfigService } from '@nestjs/config';

@Module({
  imports: [
    PassportModule.register({ defaultStrategy: 'jwt' }),
    JwtModule.register({
      secret: configService.get&lt;string&gt;('JWT_SECRET'),
      // Durée de validité du token 
      signOptions: { expiresIn: '1h' }, 
    }),
  ],
  providers: [AuthService, JwtStrategy],
  exports: [AuthService],
})
export class AuthModule {}
</div></section><section class="chapter"><h4 id="la-strat-gie" data-toc="la-strat-gie">La strat&eacute;gie</h4><div class="code-block" data-lang="ts">
// auth/jwt.strategy.ts


import { Injectable } from '@nestjs/common';
import { PassportStrategy } from '@nestjs/passport';
import { ExtractJwt, Strategy } from 'passport-jwt';
import { ConfigService } from '@nestjs/config';

@Injectable()
export class JwtStrategy extends PassportStrategy(Strategy) {
  constructor(configService: ConfigService) {
    super({
      jwtFromRequest: ExtractJwt.fromAuthHeaderAsBearerToken(),
      ignoreExpiration: false,
      secretOrKey: configService.get&lt;string&gt;('JWT_SECRET'),
    });
  }

  async validate(payload: any) {
    return { userId: payload.sub, email: payload.email };
  }
}
</div><div class="code-block" data-lang="ts">
// auth/jwt-auth-guard.ts

import { Injectable } from '@nestjs/common';
import { AuthGuard } from '@nestjs/passport';

@Injectable()
export class JwtAuthGuard extends AuthGuard('jwt') {}
</div></section></section></section><section class="chapter"><h2 id="autorisation" data-toc="autorisation">Autorisation</h2></section><div class="last-modified">Last modified: 27 février 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="008-00-plus-loin-avec-mongoose.html" class="navigation-links__prev">Plus loin avec Mongoose</a><a href="016-00-les-tests.html" class="navigation-links__next">Les tests</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.10.0-b575/app.js"></script></body></html>